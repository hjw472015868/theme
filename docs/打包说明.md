# æ‰“åŒ…è¯´æ˜

> è¯´æ˜ `workspace:*` åè®®å¯¹é¡¹ç›®æ‰“åŒ…çš„å½±å“

## ğŸ“‹ ç›®å½•

- [workspace åè®®è¯´æ˜](#workspace-åè®®è¯´æ˜)
- [æ‰“åŒ…æœºåˆ¶](#æ‰“åŒ…æœºåˆ¶)
- [æ‰“åŒ…éªŒè¯](#æ‰“åŒ…éªŒè¯)
- [æ³¨æ„äº‹é¡¹](#æ³¨æ„äº‹é¡¹)

---

## ğŸ”— workspace åè®®è¯´æ˜

### ä»€ä¹ˆæ˜¯ workspace åè®®ï¼Ÿ

`workspace:*` æ˜¯ pnpm çš„ workspace åè®®ï¼Œç”¨äºåœ¨ monorepo ä¸­é“¾æ¥æœ¬åœ°åŒ…ã€‚

### å·¥ä½œåŸç†

```json
// apps/km-artizen-ai-ui/package.json
{
  "dependencies": {
    "@km-design/theme-system": "workspace:*"
  }
}
```

**pnpm ä¼š**ï¼š

1. åœ¨ `node_modules/@km-design/theme-system` åˆ›å»ºç¬¦å·é“¾æ¥
2. ç¬¦å·é“¾æ¥æŒ‡å‘ `packages/theme-system`
3. æ‰“åŒ…å·¥å…·ï¼ˆUmiJS/Webpackï¼‰ä¼šè§£æè¿™ä¸ªç¬¦å·é“¾æ¥

### å®é™…æ•ˆæœ

```bash
# ç¬¦å·é“¾æ¥
apps/km-artizen-ai-ui/node_modules/@km-design/theme-system
  -> ../../../../packages/theme-system
```

---

## ğŸ“¦ æ‰“åŒ…æœºåˆ¶

### UmiJS æ‰“åŒ…æµç¨‹

1. **ä¾èµ–è§£æ**
   - UmiJS é€šè¿‡ webpack è§£æä¾èµ–
   - webpack ä¼šè·Ÿéšç¬¦å·é“¾æ¥æ‰¾åˆ°å®é™…æ–‡ä»¶
   - è¯»å– `packages/theme-system/dist/` ä¸­çš„æ„å»ºæ–‡ä»¶

2. **ä»£ç æ‰“åŒ…**
   - webpack ä¼šè¯»å– `dist/index.js` æˆ– `dist/index.esm.js`
   - å°†ä¸»é¢˜åŒ…çš„ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆäº§ç‰©ä¸­
   - ä¸ä¼šåŒ…å«æºä»£ç ï¼ŒåªåŒ…å«æ„å»ºåçš„ä»£ç 

3. **èµ„æºå¤„ç†**
   - CSS/LESS æ–‡ä»¶ä¼šè¢«æ­£ç¡®å¤„ç†
   - é™æ€èµ„æºä¼šè¢«å¤åˆ¶åˆ°è¾“å‡ºç›®å½•

### æ‰“åŒ…ç»“æœ

**å¼€å‘æ¨¡å¼**ï¼š

- âœ… ä½¿ç”¨ `workspace:*` åè®®
- âœ… ç¬¦å·é“¾æ¥æŒ‡å‘ `packages/theme-system`
- âœ… å®æ—¶ä½¿ç”¨æœ€æ–°ä»£ç 

**ç”Ÿäº§æ‰“åŒ…**ï¼š

- âœ… webpack è§£æç¬¦å·é“¾æ¥
- âœ… è¯»å– `packages/theme-system/dist/` ä¸­çš„æ„å»ºæ–‡ä»¶
- âœ… å°†æ„å»ºåçš„ä»£ç æ‰“åŒ…åˆ°æœ€ç»ˆäº§ç‰©
- âœ… **ä¸ä¼šåŒ…å«æºä»£ç **

---

## âœ… æ‰“åŒ…éªŒè¯

### éªŒè¯æ–¹æ³•

#### 1. æ£€æŸ¥ç¬¦å·é“¾æ¥

```bash
cd apps/km-artizen-ai-ui
ls -la node_modules/@km-design/theme-system
# åº”è¯¥æ˜¾ç¤ºç¬¦å·é“¾æ¥æŒ‡å‘ packages/theme-system
```

#### 2. æ£€æŸ¥æ„å»ºæ–‡ä»¶

```bash
# ç¡®ä¿ä¸»é¢˜åŒ…å·²æ„å»º
cd packages/theme-system
pnpm build

# æ£€æŸ¥æ„å»ºæ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la dist/
# åº”è¯¥çœ‹åˆ° index.js, index.esm.js, index.d.ts ç­‰æ–‡ä»¶
```

#### 3. æ‰“åŒ…æµ‹è¯•

```bash
# æ‰“åŒ…é¡¹ç›®
cd apps/km-artizen-ai-ui
pnpm build

# æ£€æŸ¥æ‰“åŒ…ç»“æœ
ls -la dist/
# æ£€æŸ¥æ˜¯å¦åŒ…å«ä¸»é¢˜åŒ…çš„ä»£ç 
```

#### 4. æ£€æŸ¥æ‰“åŒ…äº§ç‰©

```bash
# æ£€æŸ¥æ‰“åŒ…åçš„ä»£ç 
grep -r "@km-design/theme-system" dist/
# åº”è¯¥èƒ½æ‰¾åˆ°ä¸»é¢˜åŒ…çš„å¼•ç”¨

# æ£€æŸ¥æ˜¯å¦åŒ…å«æºä»£ç 
grep -r "packages/theme-system/src" dist/
# ä¸åº”è¯¥æ‰¾åˆ°æºä»£ç è·¯å¾„
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. ç¡®ä¿ä¸»é¢˜åŒ…å·²æ„å»º

**é‡è¦**ï¼šæ‰“åŒ…å‰å¿…é¡»æ„å»ºä¸»é¢˜åŒ…

```bash
# æ‰“åŒ…å‰å…ˆæ„å»ºä¸»é¢˜åŒ…
cd packages/theme-system
pnpm build

# ç„¶åå†æ‰“åŒ…é¡¹ç›®
cd ../../apps/km-artizen-ai-ui
pnpm build
```

### 2. æ„å»ºé¡ºåº

**æ¨è**ï¼šåœ¨æ ¹ç›®å½•ä½¿ç”¨ç»Ÿä¸€æ„å»ºå‘½ä»¤

```bash
# æ ¹ç›®å½• package.json
{
  "scripts": {
    "build": "pnpm build:packages && pnpm build:ai-ui",
    "build:packages": "pnpm --filter \"./packages/**\" build",
    "build:ai-ui": "pnpm --filter km-artizen-ai-ui build"
  }
}
```

### 3. CI/CD æµç¨‹

**åœ¨ CI/CD ä¸­**ï¼š

```bash
# 1. å®‰è£…ä¾èµ–
pnpm install

# 2. æ„å»ºæ‰€æœ‰åŒ…
pnpm build:packages

# 3. æ„å»ºåº”ç”¨
pnpm build:ai-ui
```

### 4. å¼€å‘æ¨¡å¼

**å¼€å‘æ—¶**ï¼š

```bash
# æ–¹å¼ä¸€ï¼šä½¿ç”¨å¼€å‘æ¨¡å¼ï¼ˆç›‘å¬æ–‡ä»¶å˜åŒ–ï¼‰
cd packages/theme-system
pnpm dev  # ç›‘å¬æ–‡ä»¶å˜åŒ–ï¼Œè‡ªåŠ¨æ„å»º

# æ–¹å¼äºŒï¼šæ‰‹åŠ¨æ„å»º
cd packages/theme-system
pnpm build  # æ„å»ºä¸€æ¬¡
```

---

## ğŸ” å¸¸è§é—®é¢˜

### Q: workspace åè®®ä¼šå½±å“æ‰“åŒ…å—ï¼Ÿ

**A**: **ä¸ä¼š**ã€‚æ‰“åŒ…å·¥å…·ï¼ˆUmiJS/Webpackï¼‰ä¼šæ­£ç¡®è§£æç¬¦å·é“¾æ¥ï¼Œè¯»å–æ„å»ºåçš„æ–‡ä»¶ï¼Œä¸ä¼šåŒ…å«æºä»£ç ã€‚

### Q: æ‰“åŒ…æ—¶éœ€è¦ç‰¹æ®Šé…ç½®å—ï¼Ÿ

**A**: **ä¸éœ€è¦**ã€‚UmiJS å’Œ Webpack éƒ½æ”¯æŒç¬¦å·é“¾æ¥ï¼Œä¼šè‡ªåŠ¨å¤„ç†ã€‚

### Q: æ‰“åŒ…å‰éœ€è¦åšä»€ä¹ˆï¼Ÿ

**A**: **ç¡®ä¿ä¸»é¢˜åŒ…å·²æ„å»º**ï¼š

```bash
cd packages/theme-system
pnpm build
```

### Q: æ‰“åŒ…åçš„ä»£ç åŒ…å«æºä»£ç å—ï¼Ÿ

**A**: **ä¸ä¼š**ã€‚æ‰“åŒ…å·¥å…·åªä¼šè¯»å– `dist/` ç›®å½•ä¸­çš„æ„å»ºæ–‡ä»¶ï¼Œä¸ä¼šåŒ…å« `src/` ç›®å½•ä¸­çš„æºä»£ç ã€‚

### Q: å¦‚ä½•éªŒè¯æ‰“åŒ…æ˜¯å¦æ­£ç¡®ï¼Ÿ

**A**:

1. **æ£€æŸ¥æ„å»ºæ–‡ä»¶**ï¼š

   ```bash
   ls packages/theme-system/dist/
   ```

2. **æ£€æŸ¥ç¬¦å·é“¾æ¥**ï¼š

   ```bash
   ls -la apps/km-artizen-ai-ui/node_modules/@km-design/theme-system
   ```

3. **æ‰“åŒ…æµ‹è¯•**ï¼š

   ```bash
   cd apps/km-artizen-ai-ui
   pnpm build
   ```

4. **æ£€æŸ¥æ‰“åŒ…äº§ç‰©**ï¼š
   ```bash
   grep -r "@km-design/theme-system" dist/
   ```

### Q: å¼€å‘æ¨¡å¼å’Œæ‰“åŒ…æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ

**A**:

| æ¨¡å¼         | ä½¿ç”¨æ–¹å¼      | ä»£ç æ¥æº                      | ç‰¹ç‚¹             |
| ------------ | ------------- | ----------------------------- | ---------------- |
| **å¼€å‘æ¨¡å¼** | `workspace:*` | `packages/theme-system/dist/` | å®æ—¶ä½¿ç”¨æœ€æ–°ä»£ç  |
| **æ‰“åŒ…æ¨¡å¼** | `workspace:*` | `packages/theme-system/dist/` | ä½¿ç”¨æ„å»ºåçš„ä»£ç  |

**ä¸¤è€…éƒ½ä½¿ç”¨æ„å»ºåçš„ä»£ç ï¼Œåªæ˜¯å¼€å‘æ¨¡å¼ä¼šå®æ—¶æ›´æ–°ã€‚**

---

## ğŸ“ æ€»ç»“

### å…³é”®ç‚¹

1. âœ… **`workspace:*` åè®®å¯¹æ‰“åŒ…æ²¡æœ‰å½±å“**
2. âœ… **æ‰“åŒ…å·¥å…·ä¼šæ­£ç¡®è§£æç¬¦å·é“¾æ¥**
3. âœ… **æ‰“åŒ…æ—¶åªä½¿ç”¨æ„å»ºåçš„ä»£ç ï¼Œä¸åŒ…å«æºä»£ç **
4. âœ… **æ‰“åŒ…å‰éœ€è¦ç¡®ä¿ä¸»é¢˜åŒ…å·²æ„å»º**

### æ¨èæµç¨‹

1. **å¼€å‘æ—¶**ï¼š

   ```bash
   cd packages/theme-system
   pnpm dev  # ç›‘å¬æ–‡ä»¶å˜åŒ–
   ```

2. **æ‰“åŒ…å‰**ï¼š

   ```bash
   cd packages/theme-system
   pnpm build  # æ„å»ºä¸»é¢˜åŒ…
   ```

3. **æ‰“åŒ…**ï¼š

   ```bash
   cd apps/km-artizen-ai-ui
   pnpm build  # æ‰“åŒ…é¡¹ç›®
   ```

4. **éªŒè¯**ï¼š
   ```bash
   # æ£€æŸ¥æ‰“åŒ…äº§ç‰©
   ls -la dist/
   ```

---

**æœ€åæ›´æ–°**: 2025-01-14  
**ç‰ˆæœ¬**: v1.0.0
