# 添加新主题指南

## 快速开始

现在添加新主题非常简单！只需要 **3 步**：

### 1. 将主题文件放入 `presets/` 目录

```bash
# 将你的主题 JSON 文件复制到 presets/ 目录
cp your-theme.json presets/your-theme.json
```

### 2. 运行生成脚本（自动）

```bash
# 自动生成导入代码
pnpm run generate:themes
```

或者直接构建（会自动运行生成脚本）：

```bash
pnpm build
```

### 3. 完成！

新主题已经自动注册，可以在项目中使用：

```typescript
// 使用新主题
<NextThemeProvider defaultTheme="your-theme">
  {children}
</NextThemeProvider>

// 或者在主题切换器中选择
const { setTheme } = useTheme();
setTheme('your-theme');
```

---

## 工作原理

### 自动扫描

系统会自动扫描 `presets/` 目录下的所有 `.json` 文件，并：

1. ✅ 自动生成导入代码（Next.js 适配器）
2. ✅ 自动注册主题
3. ✅ 自动导出主题（主入口文件）
4. ✅ 自动同步到 `src/presets/` 目录（用于构建）

### 主题文件命名

- 文件名：`your-theme.json`（kebab-case）
- 主题名称：`your-theme`（用于注册和使用）
- 变量名：`yourTheme`（自动转换为 camelCase）

### 特殊处理

- 如果文件名已经包含 `theme`（如 `km-flow-light-theme.json`），变量名不会重复添加 `Theme`
- `default` 和 `dark` 主题会优先排序
- 如果没有 `light.json`，系统会自动使用 `default` 作为 `light` 的别名

---

## 框架支持

### UmiJS 项目

✅ **完全自动** - 使用 `require.context` 自动加载所有主题，无需任何配置！

### Next.js 项目

✅ **自动生成** - 构建时自动生成静态导入代码，无需手动配置！

---

## 注意事项

1. ⚠️ **不要手动修改** `src/provider/nextjs-adapter.tsx` 和 `src/index.ts` 中的主题导入代码
   - 这些文件由脚本自动生成
   - 手动修改会在下次生成时被覆盖

2. ✅ **主题文件格式**
   - 必须是有效的 JSON 文件
   - 必须包含 `meta` 字段（至少包含 `name`）
   - 必须包含 `colors` 字段

3. 📦 **构建前运行**
   - 添加新主题后，记得运行 `pnpm build` 重新构建
   - 或者直接运行 `pnpm run generate:themes` 生成代码

4. 🔄 **同步到 GitHub**
   - 添加新主题后，记得提交并推送到 GitHub
   - 创建版本标签时，同时更新 `latest` 标签
   - 其他项目使用 `latest` 标签时，重新安装即可获取新主题

**发布新主题时的完整流程**：

```bash
# 1. 提交代码
git add .
git commit -m "feat: 添加新主题"

# 2. 推送到 GitHub
git push origin main

# 3. 创建版本标签
git tag v1.0.1

# 4. 更新 latest 标签（重要！）
git tag -f latest v1.0.1

# 5. 推送标签
git push origin v1.0.1
git push origin latest --force
```

---

## 示例

### 添加一个新主题 `ocean-blue.json`

```bash
# 1. 创建主题文件
cat > presets/ocean-blue.json << 'EOF'
{
  "meta": {
    "name": "Ocean Blue",
    "version": "1.0.0",
    "description": "海洋蓝主题"
  },
  "colors": {
    "primary": {
      "500": "#0066CC"
    }
  }
}
EOF

# 2. 生成导入代码
pnpm run generate:themes

# 3. 构建
pnpm build

# 4. 提交
git add presets/ocean-blue.json
git commit -m "feat: 添加 ocean-blue 主题"
git push
```

### 使用新主题

```typescript
import { NextThemeProvider } from '@km-design/theme-system';

export default function Layout({ children }) {
  return (
    <NextThemeProvider defaultTheme="ocean-blue">
      {children}
    </NextThemeProvider>
  );
}
```

---

## 故障排除

### 问题：新主题没有被识别

**解决方案：**

1. 确保文件在 `presets/` 目录下
2. 确保文件名以 `.json` 结尾
3. 运行 `pnpm run generate:themes` 重新生成
4. 运行 `pnpm build` 重新构建

### 问题：构建失败

**解决方案：**

1. 检查 JSON 文件格式是否正确
2. 检查文件是否包含必需的字段（`meta`, `colors`）
3. 查看构建错误信息

### 问题：变量名重复

**解决方案：**

- 如果文件名已经包含 `theme`，系统会自动处理
- 如果仍有问题，检查 `scripts/generate-theme-imports.js` 中的逻辑

---

## 总结

🎉 **现在添加新主题只需要：**

1. 把文件放到 `presets/` 目录
2. 运行 `pnpm build`（或 `pnpm run generate:themes`）
3. 完成！

无需手动配置任何代码！🚀
